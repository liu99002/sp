## 第二章：LLVM IR 的基本結構

### 2.1 LLVM IR 概覽

LLVM (Low-Level Virtual Machine) 是一個面向編譯器和代碼優化的開源項目，同時也是一個三地址碼的中間表示形式。LLVM IR（Intermediate Representation）是 LLVM 的中間表示，用於表達高級語言的代碼。

LLVM IR 是一種靜態單賦值形式（SSA）的三地址碼，它包含了指令、變量、函數等組成部分。它具有以下特點：

- 高度彈性：LLVM IR 可以描述各種高級語言的程式碼，同時也可以輕鬆地進行代碼轉換和優化。
- 可讀性：LLVM IR 是一種人可讀的代碼形式，易於理解和分析。
- 平台無關：LLVM IR 非常便於移植到不同的硬體平台上，同時也支援多種程式語言。
- 支援靜態和動態編譯：LLVM IR 可以被靜態編譯為機器碼，也可以被即時編譯器（JIT）以及動態編譯器使用。

### 2.2 LLVM IR 的結構

LLVM IR 由多個基本組成部分組成，包括模組（Module）、函數（Function）、基本塊（Basic Block）、指令（Instruction）等。下面將詳細介紹每個部分的功能和結構。

#### 2.2.1 模組（Module）

模組是 LLVM IR 的最頂層結構，它包含了程式碼中所有的函數、全局變量等。可以將模組看作一個整體的程式碼單位。每個模組只能包含一個命名的函數作為進入點（Entry Point），這個函數通常是程式的開始點。

#### 2.2.2 函數（Function）

函數是 LLVM IR 的中級結構，它包含了一個具體的程式碼邏輯。每個函數都包含了一個或多個基本塊，用於確定程式碼的執行順序和流程控制。

#### 2.2.3 基本塊（Basic Block）

基本塊是最基本的代碼組織單元，它由一組連續的指令組成。每個基本塊有唯一的標籤（Label），用於確定程式碼的跳轉目的地。基本塊內的指令順序是固定的，同時每個基本塊內的指令都是連續的。

#### 2.2.4 指令（Instruction）

指令是 LLVM IR 最基本的操作單位，它包含了各種不同的操作，例如算術運算、控制流操作、內存操作等。每個指令都有一個操作碼（Opcode）和相應的操作數（Operand），用於執行具體的功能。

### 2.3 LLVM IR 的示例

以下是一個簡單的 LLVM IR 程式碼示例，用於計算兩個整數的和：

```ll
define i32 @add(i32 %a, i32 %b) {
  entry:
    %sum = add i32 %a, %b
    ret i32 %sum
}
```

在這個示例中，我們定義了一個名為 "add" 的函數，接受兩個 i32（32 位整數）類型的參數。

在函數的基本塊(entry)中，我們使用 "add" 指令將兩個參數 %a 和 %b 相加，並將結果存儲在 %sum 中。

最後，我們使用 "ret" 指令返回 %sum 作為函數的結果。

這個示例展示了 LLVM IR 中的一些基本概念，包括函數的定義、基本塊的組織和指令的使用。

### 2.4 總結

本章我們介紹了 LLVM IR 的基本結構，包括模組、函數、基本塊和指令等。LLVM IR 是一種靜態單賦值形式的三地址碼，具有高度彈性、可讀性和平台無關性等優點。在下一章中，我們將學習如何使用 LLVM 工具來編譯和優化 LLVM IR 程式碼。